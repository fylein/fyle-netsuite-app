<nav class="sub-navbar navbar fixed-top navbar-light d-flex flex-column">
    <div class="sub-navbar-heading">
        <h1 class="navbar-brand">Settings</h1>
    </div>
    <ul class="nav sub-nav-tabs d-flex flex-row tabSection">
        <li class="sub-nav-item">
            <a class="sub-nav-link {{source}}" (click)="toggleState('source')">Source</a>
        </li>
        <li class="sub-nav-item">
            <a class="sub-nav-link {{destination}}" (click)="toggleState('destination')">Destination</a>
        </li>
        <li class="sub-nav-item">
            <a class="sub-nav-link {{settings}}" (click)="toggleState('settings')">Configurations</a>
        </li>
        <li class="sub-nav-item">
            <a class="sub-nav-link {{subsidiary}}" (click)="toggleState('subsidiary')">Subsidiary</a>
        </li>
        <li class="sub-nav-item">
            <a class="sub-nav-link {{schedule}}" (click)="toggleState('schedule')">Auto Import/Export</a>
        </li>
    </ul>
</nav>
<div class="tabitem-content" *ngIf="state === 'source'">
    <div class="login center-div mt-5" *ngIf="fyleConnected && !isLoading">
        <p>Connected to your Fyle account</p>
    </div>
    <div class="login center-div mt-5" *ngIf="!fyleConnected && !isLoading">
        <p>Connect to your Fyle account</p>
        <button class="btn btn-lg main-btn" (click)="connectFyle()">Connect</button>
        <div class="text-danger mt-2" *ngIf="error">
            <p>{{error}}</p>
        </div>
    </div>
</div>

<div class="tabitem-content" *ngIf="state === 'destination' && !isLoading">
    <div class="login center-div mt-5" *ngIf="netsuiteConnected && !isLoading">
        <p>Connected to your NetSuite account</p>
    </div>
    <div class="schedule-content">
        <form [formGroup]="form" (ngSubmit)="submit()" *ngIf="!netsuiteConnected && !isLoading">
            <div class="mb-2 col-5">
                <p>
                    Connect your Netsuite account to export expenses. <a class="support" href="https://www.fylehq.com/help/en/articles/2012953-integration-with-oracle-netsuite" target="_blank">Read more</a>
                </p>
            </div>
            <label class=" control-label col-md-3">NetSuite Account ID</label>
            <div class="col-md-4">
              <input class="form-control" type="text" formControlName="nsAccountId">
            </div><br/>

            <div class="text-danger mb-2 col-3" *ngIf="!nsAccountIdIsValid">
                <small>
                    Account ID cannot be empty
                </small>
            </div>
        
            <label class=" control-label col-md-3">NetSuite Consumer Key</label>
            <div class="col-md-4">
              <input class="form-control" type="text" formControlName="nsConsumerKey">
            </div><br/>

            <div class="text-danger mb-2 col-3" *ngIf="!nsConsumerKeyIsValid">
                <small>
                    Consumer Key cannot be empty
                </small>
            </div>
        
            <label class=" control-label col-md-3">NetSuite Consumer Secret</label>
            <div class="col-md-4">
              <input class="form-control" type="text" formControlName="nsConsumerSecret">
            </div><br/>

            <div class="text-danger mb-2 col-3" *ngIf="!nsConsumerSecretIsValid">
                <small>
                    Consumer Secret cannot be empty
                </small>
            </div>

            <label class=" control-label col-md-3">NetSuite Token ID</label>
            <div class="col-md-4">
              <input class="form-control" type="text" formControlName="nsTokenId">
            </div><br/>

            <div class="text-danger mb-2 col-3" *ngIf="!nsTokenIdIsValid">
                <small>
                    Token ID cannot be empty
                </small>
            </div>

            <label class=" control-label col-md-3">NetSuite Token Secret</label>
            <div class="col-md-4">
              <input class="form-control" type="text" formControlName="nsTokenSecret">
            </div><br/>

            <div class="text-danger mb-2 col-3" *ngIf="!nsTokenSecretIsValid">
                <small>
                    Token Secret cannot be empty
                </small>
            </div>
    
            <div class="col-md-4">
                <button class="main-btn btn save-btn" type="submit">Connect</button>
            </div>

            <div class="text-danger mt-2 mb-2 col-5" *ngIf="!netsuiteConnected">
                <p>{{error}}</p>
            </div>
            <div class="text-danger mt-2 mb-2 col-5" *ngIf="invalidLogin">
                <p>Invalid Login Attempt</p>
            </div>
        </form>
    </div>
</div>

<div class="tabitem-content" *ngIf="state === 'settings' && !isLoading">
    <div class="schedule-content">
        <form  *ngIf="generalSettings" [formGroup]="generalSettingsForm">
            <div>
                Please map the following Fyle fields to their NetSuite equivalent.
            </div>
            <div class="settings-object">
                <label for="employeeFieldOptions" class="d-flex"> Map Employees from Fyle to </label>
                <select formControlName="employeeFieldOptions" id="employeeFieldOptions" class="form-control selectpicker col-4">
                    <option *ngFor="let employeeMappingsObject of employeeFieldOptions; let i = index"
                        [selected]="employeeFieldOptions[i].name === employeeFieldMapping.destination_field" [value]="employeeFieldOptions[i].name">
                        {{employeeFieldOptions[i].name}}
                    </option>
                </select>
            </div>
    
            <div class="text-danger mb-2" *ngIf="!employeeMappingsObjectIsValid">
                <small>
                    Employee Field Mappings Object should not be empty
                </small>
            </div>
    
            <div class="settings-object">
                <label for="reimbursableExpensesObjects" class="d-flex"> Map reimbursable Expenses from Fyle to </label>
                <select formControlName="reimbursableExpensesObjects" id="reimbursableExpensesObjects" class="form-control selectpicker col-4">
                    <option *ngFor="let accountPayableAccount of reimbursableExpensesObjects; let i = index"
                        [selected]="reimbursableExpensesObjects[i].name === generalSettings?.reimbursable_expenses_object" [value]="reimbursableExpensesObjects[i].name">
                        {{reimbursableExpensesObjects[i].name}}
                    </option>
                </select>
            </div>
    
            <div class="text-danger mb-2" *ngIf="!reimbursableExpensesObjectIsValid">
                <small>
                    Reimbursable Expenses Object should not be empty
                </small>
            </div>
    
            <div class="settings-object">
                <label for="cccExpensesObjects" class="d-flex"> Map Corporate Credit Card Expenses from Fyle to </label>
                <select formControlName="cccExpensesObjects" id="cccExpensesObjects" class="form-control selectpicker col-4">
                    <option [ngValue]="null">None</option>
                    <option *ngFor="let accountPayableAccount of cccExpensesObjects; let i = index"
                        [selected]="cccExpensesObjects[i].name === generalSettings?.corporate_credit_card_expenses_object" [value]="cccExpensesObjects[i].name">
                        {{cccExpensesObjects[i].name}}
                    </option>
                </select>
            </div>
    
            <div class="settings-object">
                <label for="projectFieldOptions" class="d-flex"> Map Projects from Fyle to </label>
                <select formControlName="projectFieldOptions" id="projectFieldOptions" class="form-control selectpicker col-4">
                    <option [ngValue]="null">None</option>
                    <option *ngFor="let option of projectFieldOptions; let i = index"
                        [selected]="projectFieldOptions[i].name === projectFieldMapping.destination_field" [value]="projectFieldOptions[i].name">
                        {{ option.name }}
                    </option>
                </select>
            </div>
    
            <div class="settings-object">
                <label for="costCenterFieldOptions" class="d-flex"> Map Cost Centers from Fyle to </label>
                <select formControlName="costCenterFieldOptions" id="costCenterFieldOptions" class="form-control selectpicker col-4">
                    <option [ngValue]="null">None</option>
                    <option *ngFor="let option of costCenterFieldOptions; let i = index"
                        [selected]="costCenterFieldOptions[i].name === costCenterFieldMapping.destination_field" [value]="costCenterFieldOptions[i].name">
                        {{ option.name }}
                    </option>
                </select>
            </div>
    
            <div class="save-schedule">
                <button class="main-btn btn save-btn" type="submit" (click)="open(content)"> Save </button>
            </div>
    
            <div class="save-schedule" *ngIf="generalSettings.corporate_credit_card_expenses_object && generalSettings.reimbursable_expenses_object && generalSettings.employee_field_mapping">
                <p>
                    To change your settings, Please send us a note at 
                    <a class="support" href="mailto:support@fyle.in">support@fyle.in</a>
                </p>
    
            </div>
    
            <ng-template #content let-modal>
                <div class="modal-header">
                    <h5 class="modal-title" id="generalSettingModalTitle">Save Configurations</h5>
                    <button type="button" class="close ml-auto" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <p class="md-caption text-danger mt-0">
                        Configurations cannot be modified once saved. Do you wish to proceed?
                    </p>
                </div>
                <div class="modal-footer">
                    <button id="cancel-btn" class="btn btnInline cancelBtn" type="button" data-dismiss="modal"
                        (click)="closeModal()">Cancel</button>
                    <button id="submit-btn" class="btn btnInline saveBtn" type="submit" name="method" (click)="submitSettings()">Save</button>
                </div>
            </ng-template>
    
        </form>
    </div>
</div>
    
<div class="tabitem-content" *ngIf="state === 'subsidiary' && !isLoading">
    <div class="schedule-content">
        <form [formGroup]="subsidiaryForm">
            <div>
                Please select your NetSuite Subsidiary.
            </div><br>
            <div class="bank-account">
                <label for="netsuiteSubsidiaries" class="d-flex">NetSuite Subsidiary</label>
                <select formControlName="netsuiteSubsidiaries" id="netsuiteSubsidiaries | async" class="form-control selectpicker col-4">
                    <option *ngFor="let bankAccount of netsuiteSubsidiaries; let i = index"
                        [selected]="netsuiteSubsidiaries[i].destination_id === subsidiaryMappings.internal_id" [value]="netsuiteSubsidiaries[i].destination_id">
                        {{netsuiteSubsidiaries[i].value}}
                    </option>
                </select>
            </div>

            <div class="text-danger mb-2" *ngIf="!subsidiaryIsValid">
                <small>
                    Subsidiary should not be empty
                </small>
            </div>

            <div class="save-schedule">
                <button class="main-btn btn save-btn" type="submit" (click)="open(content)">Save</button>
            </div>
    
            <div class="save-schedule">
                <p>
                    To change your NetSuite subsidiary, please reach out to us at 
                    <a class="support" href="mailto:support@fyle.in">support@fyle.in.</a>
                </p>
    
            </div>
    
            <ng-template #content let-modal>
                <div class="modal-header">
                    <h5 class="modal-title" id="generalSettingModalTitle">Save Subsidiary</h5>
                    <button type="button" class="close ml-auto" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <p class="md-caption text-danger mt-0">
                        Subsidiary cannot be modified once saved. Do you wish to proceed?
                    </p>
                </div>
                <div class="modal-footer">
                    <button id="cancel-btn" class="btn btnInline cancelBtn" type="button" data-dismiss="modal"
                        (click)="closeModal()">Cancel</button>
                    <button id="submit-btn" class="btn btnInline saveBtn" type="submit" name="method" (click)="submitSubsidiary()">Save</button>
                </div>
            </ng-template>
    
        </form>
    </div>
</div>

<div class="tabitem-content" *ngIf="state === 'schedule' && !isLoading">
    <div class="schedule-content">
        <form [formGroup]="scheduleForm" (ngSubmit)="submitScheduleSettings()">
            <div>
                Set up an automatic process for importing expense groups from Fyle and exporting them to NetSuite.
            </div><br>
            <div class="d-flex enable-schedule">
                <p>Status</p>
                <input type="checkbox" id="schedule-enabled" name="schedule" (value)="scheduleEnabled" class="switch-input"
                    formControlName="scheduleEnabled" checked>
                <label for="schedule-enabled" class="switch-label"></label>
            </div>
            <div class="d-flex repeat-frequency row">
                <div class="col-2">
                    <p>Repeat every</p>
                </div>
                <div class="schedule-input-group">
                    <input id="changeHourStep" type="number" min="1" oninput="validity.valid||(value='');"
                        class="form-control" formControlName="hours" required />
                </div>
                <div>
                    hours
                </div>
                <div class="text-danger mb-2 col-3" *ngIf="!frequencyIsValid">
                    <small>
                        frequency field cannot be empty
                    </small>
                </div>
            </div>
            <div class="row">
                <div class="col-2">
                    <p>Start Date</p>
                </div>
                <div class="input-group col-3">
                    <ng2-flatpickr placeholder="YYYY-MM-DD HH:MM" formControlName="datetime" [config]="datetimePickerOptions"></ng2-flatpickr>
                </div>
                <div class="text-danger mb-2 col-3" *ngIf="!datetimeIsValid">
                    <small>
                        date time field cannot be empty
                    </small>
                </div>
            </div>
            <div class="save-schedule">
                <button class="main-btn btn save-btn" type="submit">Save Schedule</button>
            </div>
        </form>
    </div>
</div>
    
<app-loader *ngIf="isLoading"></app-loader>
